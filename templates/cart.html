<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gi·ªè h√†ng | Xi√™n S·∫°ch Online</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#f6f6f6}

/* ===== HEADER ===== */
header{
  position:fixed;top:0;left:0;right:0;height:56px;
  background:#ff7a00;color:#fff;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 12px;z-index:1000;
}
.menu-btn{font-size:24px;cursor:pointer}
.logo{font-weight:bold;font-size:15px}
.cart{position:relative;font-size:22px;cursor:pointer}
.cart span{
  position:absolute;top:-6px;right:-6px;
  background:red;color:#fff;
  font-size:11px;padding:2px 6px;border-radius:50%;
}

/* ===== NAV ===== */
.nav{
  position:fixed;top:56px;left:0;right:0;
  background:#fff;display:none;flex-direction:column;
  border-bottom:1px solid #ddd;z-index:999;
}
.nav a{
  padding:14px;text-decoration:none;color:#333;
  border-bottom:1px solid #eee;
}
.nav.show{display:flex}

/* ===== MAIN ===== */
.main{padding:72px 16px;max-width:600px;margin:auto}

/* ===== CLEAR ===== */
.clear-bar{text-align:right;margin-bottom:8px}
.clear-all{font-size:13px;color:#e74c3c;font-weight:600;cursor:pointer}

/* ===== EMPTY ===== */
.empty{
  background:#fff;border-radius:16px;padding:28px;text-align:center
}
.empty button{
  margin-top:16px;padding:12px 20px;border:none;
  border-radius:999px;background:#ff7a00;color:#fff;font-weight:bold
}

/* ===== ITEM ===== */
.item{
  background:#fff;border-radius:16px;padding:14px;
  margin-bottom:12px
}
.item-top{display:flex;justify-content:space-between;margin-bottom:6px}
.qty{display:flex;align-items:center;gap:8px}
.qty button{
  width:28px;height:28px;border:none;border-radius:6px;
  background:#ff7a00;color:#fff
}
.qty .del{background:#e74c3c}

/* ===== TOTAL ===== */
.total-box{
  background:#fff;border-radius:18px;padding:16px;margin-top:16px
}
.total-line{
  display:flex;justify-content:space-between;
  font-weight:bold;color:#ff7a00
}
.order-btn{
  margin-top:14px;width:100%;padding:14px;border:none;
  border-radius:18px;background:#ff7a00;color:#fff;
  font-size:16px;font-weight:bold
}
.order-btn:disabled{opacity:.6}

/* ===== POPUP ===== */
.popup{
  position:fixed;inset:0;background:rgba(0,0,0,.5);
  display:none;align-items:center;justify-content:center;z-index:2000
}
.popup.show{display:flex}
.popup-box{
  background:#fff;border-radius:18px;padding:18px;
  width:90%;max-width:360px;position:relative
}
.close{
  position:absolute;top:10px;right:12px;
  font-size:20px;cursor:pointer
}

/* ===== SAUCE UX ===== */
.sauce-grid{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  margin:14px 0;
}
.sauce{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 14px;
  border:1px solid #ddd;
  border-radius:14px;
  cursor:pointer;
  font-size:14px;
}
.sauce span{font-size:12px;color:#777}
.sauce.active{
  border-color:#ff7a00;
  background:#fff7f0;
  font-weight:bold
}
.extra-box{
  margin-top:10px;
  padding:12px;
  border-radius:14px;
  border:1px dashed #ffb380;
  background:#fffaf5;
  font-size:14px;
}
.temp-total{
  display:flex;
  justify-content:space-between;
  margin-top:12px;
  font-weight:bold;
  color:#ff7a00
}

/* ===== FORM ===== */
input,textarea{
  width:100%;padding:10px;border-radius:12px;
  border:1px solid #ddd;margin-bottom:10px
}
</style>
</head>

<body>

<header>
  <div class="menu-btn" id="menuBtn">‚ò∞</div>
  <div class="logo">GI·ªé H√ÄNG</div>
  <div class="cart" onclick="location.href='/cart'">
    üõí<span id="cartCount">0</span>
  </div>
</header>

<div class="nav" id="navMenu">
  <a href="/">üè† Trang ch·ªß</a>
  <a href="/menu">üç¢ Menu</a>
  <a href="/cart">üõí Gi·ªè h√†ng</a>
  <a href="/program">üéÅ Ch∆∞∆°ng tr√¨nh</a>
  <a href="/about">‚ÑπÔ∏è Gi·ªõi thi·ªáu</a>
  <a href="/contact">üìû Li√™n h·ªá</a>
</div>

<div class="main" id="app"></div>

<!-- ===== POPUP SAUCE ===== -->
<div class="popup" id="saucePopup">
  <div class="popup-box">
    <span class="close" onclick="closeSauce()">‚úï</span>

    <b>ü•£ Ch·ªçn n∆∞·ªõc ch·∫•m</b>

    <div class="sauce-grid">
      <div class="sauce" onclick="toggleSauce(this)">
        Chua ng·ªçt <span>M·∫∑c ƒë·ªãnh</span>
      </div>
      <div class="sauce" onclick="toggleSauce(this)">
        S·ªët me <span>ƒê·∫≠m v·ªã</span>
      </div>
    </div>

    <div class="extra-box">
      <label>
        <input type="checkbox" id="rimCheck" onchange="updateTempTotal()">
        Rim s·ªët me <b style="color:#ff7a00">+10.000ƒë</b>
      </label>
    </div>

    <div class="temp-total">
      <span>T·∫°m t√≠nh</span>
      <span id="tempTotal">0ƒë</span>
    </div>

    <button class="order-btn" onclick="openForm()">Ti·∫øp t·ª•c</button>
  </div>
</div>

<!-- ===== FORM ===== -->
<div class="popup" id="formPopup">
  <div class="popup-box">
    <span class="close" onclick="closeForm()">‚úï</span>

    <form method="POST" action="/place-order" onsubmit="return prepareSubmit()">
      <input name="name" placeholder="H·ªç t√™n *" required>
      <input name="phone" placeholder="SƒêT *" required pattern="0[0-9]{9}">
      <input name="address" placeholder="ƒê·ªãa ch·ªâ *" required>
      <textarea name="note" placeholder="Ghi ch√∫"></textarea>

      <input type="text" name="website" style="display:none">

      <input type="hidden" name="cart_text" id="cart_text">
      <input type="hidden" name="sauce_text" id="sauce_text">
      <input type="hidden" name="total" id="total">
      <input type="hidden" name="order_token" id="order_token">
      <input type="hidden" name="timestamp" id="timestamp">

      <button class="order-btn" id="submitBtn" type="submit">
        ƒê·∫∂T H√ÄNG
      </button>
    </form>
  </div>
</div>

<script>
/* ===== MENU ===== */
menuBtn.onclick = ()=>navMenu.classList.toggle("show");
document.addEventListener("click",e=>{
  if(!navMenu.contains(e.target)&&!menuBtn.contains(e.target)){
    navMenu.classList.remove("show");
  }
});

/* ===== CART ===== */
function getCart(){return JSON.parse(localStorage.getItem("cart"))||[]}
function updateCartCount(){
  cartCount.innerText = getCart().reduce((s,i)=>s+i.qty,0);
}

/* ===== RENDER ===== */
const app = document.getElementById("app");
let sauces=[], totalBase=0, isSubmitting=false;

function render(){
  const cart=getCart(); updateCartCount();
  if(!cart.length){
    app.innerHTML=`<div class="empty"><h3>Gi·ªè h√†ng tr·ªëng</h3>
    <button onclick="location.href='/menu'">Quay l·∫°i menu</button></div>`;
    return;
  }
  totalBase=0;
  let html=`<div class="clear-bar">
    <span class="clear-all" onclick="clearCart()">Xo√° t·∫•t c·∫£</span></div>`;
  cart.forEach((i,idx)=>{
    totalBase+=i.price*i.qty;
    html+=`<div class="item">
      <div class="item-top"><b>${i.name}</b>
      <span>${(i.price*i.qty).toLocaleString()}ƒë</span></div>
      <div class="qty">
        <button onclick="chg(${idx},-1)">-</button>${i.qty}
        <button onclick="chg(${idx},1)">+</button>
        <button class="del" onclick="delItem(${idx})">‚ùå</button>
      </div></div>`;
  });
  html+=`<div class="total-box">
    <div class="total-line"><span>T·ªïng c·ªông</span>
    <span>${totalBase.toLocaleString()}ƒë</span></div>
    <button class="order-btn" onclick="openSauce()">ƒê·∫∂T H√ÄNG</button>
  </div>`;
  app.innerHTML=html;
}

/* ===== ACTION ===== */
function chg(i,d){const c=getCart();c[i].qty+=d;if(c[i].qty<=0)c.splice(i,1);
localStorage.setItem("cart",JSON.stringify(c));render();}
function delItem(i){const c=getCart();c.splice(i,1);
localStorage.setItem("cart",JSON.stringify(c));render();}
function clearCart(){
  if(!confirm("Xo√° to√†n b·ªô gi·ªè h√†ng?"))return;
  localStorage.removeItem("cart");render();updateCartCount();
}

/* ===== SAUCE ===== */
function openSauce(){
  sauces=[];rimCheck.checked=false;
  document.querySelectorAll(".sauce").forEach(s=>s.classList.remove("active"));
  saucePopup.classList.add("show");
  updateTempTotal();
}
function closeSauce(){saucePopup.classList.remove("show")}
function toggleSauce(el){
  const name=el.childNodes[0].textContent.trim();
  if(el.classList.contains("active")){
    el.classList.remove("active");
    sauces=sauces.filter(s=>s!==name);
  }else{
    if(sauces.length>=2)return;
    el.classList.add("active");sauces.push(name);
  }
}
function updateTempTotal(){
  tempTotal.innerText=(totalBase+(rimCheck.checked?10000:0)).toLocaleString()+"ƒë";
}

/* ===== FORM ===== */
function openForm(){closeSauce();formPopup.classList.add("show")}
function closeForm(){formPopup.classList.remove("show")}
function prepareSubmit(){
  if(isSubmitting)return false;
  const cart=getCart(); if(!cart.length)return false;
  const finalTotal=totalBase+(rimCheck.checked?10000:0);

  cart_text.value=cart.map(i=>`${i.name} x${i.qty}`).join("; ");
  sauce_text.value=(sauces.length?sauces.join(", "):"Chua ng·ªçt")
    +(rimCheck.checked?" | Rim s·ªët me (+10.000ƒë)":"");
  total.value=finalTotal;
  order_token.value=crypto.randomUUID();
  timestamp.value=Date.now();

  isSubmitting=true;
  submitBtn.disabled=true;
  submitBtn.innerText="ƒêANG G·ª¨I...";
  return true;
}

/* INIT */
render();updateCartCount();

// ===== SPAM WARNING =====
const params = new URLSearchParams(window.location.search);
if(params.get("spam") === "1"){
  alert("‚è≥ B·∫°n v·ª´a ƒë·∫∑t h√†ng xong.\nVui l√≤ng ƒë·ª£i v√†i ph√∫t r·ªìi ƒë·∫∑t ti·∫øp nh√©!");
}

</script>

</body>
</html>
